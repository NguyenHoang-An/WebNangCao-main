<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= product ? product.name : "S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i" %></title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-yIF3r+3gPyFfQwMkqSnSraUtvHgFSzA9eR1lEY4TkHQNQ1wZy3zGyOY04cRLcYx1SnZckFZx41G1GlNvM2Kj5A=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">
  <!-- Header -->
  <header class="bg-red-600 text-white px-4 py-3 shadow flex items-center justify-between">
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <img src="/uploads/logo.png" alt="logo" class="w-auto h-16" />
      <span class="font-bold text-lg">cellphone<span class="text-white">S</span></span>
    </div>

    <!-- T√¨m ki·∫øm -->
    <form action="/products/search" method="GET" class="w-1/3 mx-4 flex">
      <input
        type="text"
        name="q"
        placeholder="B·∫°n c·∫ßn t√¨m g√¨?"
        class="w-full px-4 py-2 rounded-l-lg text-black focus:outline-none"
      />
      <button type="submit" class="bg-white text-red-600 px-4 py-2 rounded-r-lg font-semibold hover:bg-gray-100">
        <i class="fas fa-search"></i>
      </button>
    </form>

    <!-- Menu -->
    <div class="flex items-center space-x-4">
      <!-- Gi·ªè h√†ng -->
      <a href="/cart" class="bg-white text-red-600 px-3 py-2 rounded-lg flex items-center font-semibold shadow hover:bg-gray-100">
        <i class="fas fa-cart-shopping mr-2"></i>
        Gi·ªè h√†ng
      </a>

      <!-- Admin -->
      <% if (user && user.role === 'admin') { %>
        <a href="/admin" class="bg-white text-red-600 px-3 py-2 rounded-lg flex items-center font-semibold shadow hover:bg-gray-100">
          <i class="fas fa-user-shield mr-2"></i>
          Admin
        </a>
      <% } %>

      <!-- Login/Logout -->
      <% if (user) { %>
        <a href="/logout" class="hover:underline">ƒêƒÉng xu·∫•t</a>
      <% } else { %>
        <a href="/login" class="hover:underline">ƒêƒÉng nh·∫≠p</a>
      <% } %>
    </div>
  </header>

  <!-- Main content -->
  <main class="max-w-xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-lg flex-1">
    <% if (product) { %>
      <div class="flex flex-col items-center">
        <img
          src="<%= product.image %>"
          alt="<%= product.name %>"
          class="w-64 h-64 object-cover rounded-xl border border-gray-300 shadow-md"
        />

        <div class="mt-4 text-center">
          <h2 class="text-2xl font-bold text-gray-800 mb-2"><%= product.name %></h2>
          <p class="text-gray-700 mb-2"><strong>M√¥ t·∫£:</strong> <%= product.description %></p>
          <p class="text-lg font-semibold text-red-600">
            Gi√°: <%= Number(product.price).toLocaleString('vi-VN') %> VND
          </p>
        </div>

        <!-- Th√™m v√†o gi·ªè h√†ng -->
        <form action="/cart/add" method="POST" class="w-full mt-5">
          <input type="hidden" name="productId" value="<%= product._id %>" />
          <input type="hidden" name="name" value="<%= product.name %>" />
          <input type="hidden" name="price" value="<%= product.price %>" />
          <button
            type="submit"
            class="w-full bg-green-500 text-white px-6 py-2 rounded-xl hover:bg-green-600 transition duration-200"
          >
            üõí Th√™m v√†o gi·ªè h√†ng
          </button>
        </form>

        <!-- Xo√° s·∫£n ph·∫©m (admin) -->
        <% if (user && user.role === 'admin') { %>
          <button
            type="button"
            class="w-full bg-red-500 text-white px-6 py-2 rounded-xl hover:bg-red-600 mt-3 transition duration-200"
            onclick="deleteProduct('<%= product._id %>');"
          >
            üóëÔ∏è Xo√° s·∫£n ph·∫©m
          </button>
        <% } %>
      </div>
    <% } else { %>
      <p class="text-center text-red-500 text-xl font-medium">S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
    <% } %>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6">
    <div class="container mx-auto text-center">
      <p>&copy; 2025 C·ª≠a H√†ng ƒêi·ªán Tho·∫°i - B·∫£n quy·ªÅn thu·ªôc v·ªÅ ch√∫ng t√¥i.</p>
      <nav class="mt-4 space-x-6">
        <a href="/privacy-policy" class="hover:underline">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
        <a href="/terms" class="hover:underline">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
        <a href="/contact" class="hover:underline">Li√™n h·ªá</a>
      </nav>
    </div>
  </footer>

  <!-- Script xo√° s·∫£n ph·∫©m -->
  <script>
    function deleteProduct(productId) {
      if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s·∫£n ph·∫©m n√†y kh√¥ng?")) {
        fetch(`/products/delete/${productId}`, {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.message) {
              alert(data.message);
              window.location.href = "/products";
            } else {
              alert("C√≥ l·ªói x·∫£y ra khi x√≥a s·∫£n ph·∫©m.");
            }
          })
          .catch((error) => {
            console.error("L·ªói:", error);
            alert("L·ªói khi x√≥a s·∫£n ph·∫©m.");
          });
      }
    }
  </script>
</body>
</html>
